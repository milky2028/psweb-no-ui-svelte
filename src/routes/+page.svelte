<script lang="ts">
	import { onMount } from 'svelte';
	import '../app.css';
	import Divider from '$lib/Divider.svelte';
	import { boot, type BootStep } from '$lib/boot.svelte';

	let status = 'uninitialized';
	let isolated = '...';
	let memory = 2;

	onMount(() => {
		isolated = `${crossOriginIsolated}`;
	});

	function onClear() {}

	async function runStep(position: number, step: BootStep) {
		for (let i = 0; i < position; i++) {
			await boot[step.id].action();
		}
	}
</script>

<Divider />

<div><strong>Status:</strong> {status}</div>
<div><strong>crossOriginIsolated:</strong> {isolated}</div>

<Divider />

<div>
	This application allows you to step through Photoshop Web's booting process with a pre-configured
	memory amount.
	<br />
	Use the checkbox next to each step to configure that step to run automatically on page reload.
</div>
<button on:click={onClear}>Clear Autoboot</button>

<Divider />

<label>
	<div>Initial WebAssembly Memory Allotment: {memory}GB</div>
	<input style="width: 300px" type="range" min="1" max="3.75" step="0.25" bind:value={memory} />
</label>

<Divider />

<div>Boot Process</div>

{#each Object.values(boot) as step, i}
	<div>
		{i + 1}. <input disabled={step.disabled} type="checkbox" checked={step.autorun} />
		<button disabled={step.disabled} on:click={() => runStep(i, step)}>{step.name}</button>
		{step.status ? ` - ${step.status}` : ''}
	</div>
{/each}
